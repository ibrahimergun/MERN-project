{"ast":null,"code":"var util = require('util'),\n    AbstractGeocoder = require('./abstractgeocoder');\n/**\n * SmartyStreets Constructor\n * @param <object> httpAdapter Http Adapter\n * @param <object> options     Options\n */\n\n\nvar SmartyStreets = function SmartyStreets(httpAdapter, auth_id, auth_token) {\n  SmartyStreets.super_.call(this, httpAdapter);\n\n  if (!auth_id && !auth_token) {\n    throw new Error('You must specify an auth-id and auth-token!');\n  }\n\n  this.auth_id = auth_id;\n  this.auth_token = auth_token;\n};\n\nutil.inherits(SmartyStreets, AbstractGeocoder);\nSmartyStreets.prototype._endpoint = 'https://api.smartystreets.com/street-address';\n/**\n* Reverse geocoding\n* @param <integer>  lat      Latittude\n* @param <integer>  lng      Longitude\n* @param <function> callback Callback method\n*/\n\nSmartyStreets.prototype.reverse = function (lat, lng, callback) {\n  if (typeof this._reverse != 'function') {\n    throw new Error(this.constructor.name + ' doesnt support reverse geocoding!');\n  }\n\n  return this._reverse(lat, lng, callback);\n};\n/**\n * Format Result\n **/\n\n\nSmartyStreets.prototype._formatResult = function (result) {\n  if (result) {\n    return [{\n      'latitude': result.metadata.latitude,\n      'longitude': result.metadata.longitude,\n      'country': null,\n      'city': result.components.city_name,\n      'zipcode': result.components.zipcode,\n      'streetName': result.components.street_name + ' ' + result.components.street_suffix,\n      'streetNumber': result.components.primary_number,\n      'countryCode': null,\n      'type': result.metadata.record_type,\n      'dpv_match': result.analysis.dpv_match_code,\n      'dpv_footnotes': result.analysis.dpv_footnotes\n    }];\n  }\n};\n/**\n* Geocode\n* @param <string>   value    Value to geocode\n* @param <function> callback Callback method\n*/\n\n\nSmartyStreets.prototype.geocode = function (value, callback) {\n  var _this = this;\n\n  var params = {\n    'street': value,\n    'auth-id': this.auth_id,\n    'auth-token': this.auth_token,\n    'format': 'json'\n  };\n  this.httpAdapter.get(this._endpoint, params, function (err, result) {\n    if (err) {\n      return callback(err);\n    } else {\n      var results = [];\n      result.forEach(function (result) {\n        results.push(_this._formatResult(result));\n      });\n      results.raw = result;\n      callback(false, results);\n    }\n  });\n};\n\nmodule.exports = SmartyStreets;","map":null,"metadata":{},"sourceType":"script"}