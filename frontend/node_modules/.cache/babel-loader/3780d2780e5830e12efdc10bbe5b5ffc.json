{"ast":null,"code":"var util = require('util');\n\nvar AbstractGeocoder = require('./abstractgeocoder');\n/**\n * Constructor\n * @param <object> httpAdapter Http Adapter\n * @param <object> options     Options (language, clientId, apiKey)\n */\n\n\nvar VirtualEarthGeocoder = function VirtualEarthGeocoder(httpAdapter, options) {\n  VirtualEarthGeocoder.super_.call(this, httpAdapter, options);\n\n  if (!this.options.apiKey || this.options.apiKey == 'undefined') {\n    throw new Error('You must specify an apiKey');\n  }\n};\n\nutil.inherits(VirtualEarthGeocoder, AbstractGeocoder); // TomTom geocoding API endpoint\n\nVirtualEarthGeocoder.prototype._endpoint = 'https://dev.virtualearth.net/REST/v1/Locations';\n/**\n* Geocode\n* @param <string>   value    Value to geocode (Address)\n* @param <function> callback Callback method\n*/\n\nVirtualEarthGeocoder.prototype._geocode = function (value, callback) {\n  var _this = this;\n\n  var params = {\n    q: value,\n    key: this.options.apiKey\n  };\n  this.httpAdapter.get(this._endpoint, params, function (err, result) {\n    if (err) {\n      return callback(err);\n    } else {\n      var results = [];\n\n      for (var i = 0; i < result.resourceSets[0].resources.length; i++) {\n        results.push(_this._formatResult(result.resourceSets[0].resources[i]));\n      }\n\n      results.raw = result;\n      callback(false, results);\n    }\n  });\n};\n/**\n* Reverse geocoding\n* @param {lat:<number>, lon:<number>}  lat: Latitude, lon: Longitude\n* @param <function> callback Callback method\n*/\n\n\nVirtualEarthGeocoder.prototype._reverse = function (value, callback) {\n  var _this = this;\n\n  var params = {\n    key: this.options.apiKey\n  };\n  var endpoint = this._endpoint + '/' + value.lat + ',' + value.lon;\n  this.httpAdapter.get(endpoint, params, function (err, result) {\n    if (err) {\n      return callback(err);\n    } else {\n      var results = [];\n\n      for (var i = 0; i < result.resourceSets[0].resources.length; i++) {\n        results.push(_this._formatResult(result.resourceSets[0].resources[i]));\n      }\n\n      results.raw = result;\n      callback(false, results);\n    }\n  });\n};\n\nVirtualEarthGeocoder.prototype._formatResult = function (result) {\n  return {\n    'latitude': result.point.coordinates[0],\n    'longitude': result.point.coordinates[1],\n    'country': result.address.countryRegion,\n    'city': result.address.locality,\n    'state': result.address.adminDistrict,\n    'zipcode': result.address.postalCode,\n    'streetName': result.address.addressLine,\n    'formattedAddress': result.address.formattedAddress\n  };\n};\n\nmodule.exports = VirtualEarthGeocoder;","map":null,"metadata":{},"sourceType":"script"}