{"ast":null,"code":"var querystring = require('querystring'),\n    util = require('util'),\n    AbstractGeocoder = require('./abstractgeocoder');\n/**\n * Constructor\n */\n\n\nvar GeocodioGeocoder = function GeocodioGeocoder(httpAdapter, apiKey) {\n  GeocodioGeocoder.super_.call(this, httpAdapter);\n\n  if (!apiKey || apiKey == 'undefined') {\n    throw new Error(this.constructor.name + ' needs an apiKey');\n  }\n\n  this.apiKey = apiKey;\n  this._endpoint = 'https://api.geocod.io/v1';\n};\n\nutil.inherits(GeocodioGeocoder, AbstractGeocoder);\n/**\n * Geocode\n * @param <string>   value    Value to geocode (Address)\n * @param <function> callback Callback method\n */\n\nGeocodioGeocoder.prototype._geocode = function (value, callback) {\n  var _this = this;\n\n  this.httpAdapter.get(this._endpoint + '/geocode', {\n    q: value,\n    api_key: querystring.unescape(this.apiKey)\n  }, function (err, result) {\n    if (err) {\n      return callback(err);\n    }\n\n    if (result.error) {\n      return callback(new Error('Status is ' + result.error), {\n        raw: result\n      });\n    }\n\n    var results = [];\n    var locations = result.results;\n\n    for (var i = 0; i < locations.length; i++) {\n      results.push(_this._formatResult(locations[i]));\n    }\n\n    results.raw = result;\n    callback(false, results);\n  });\n};\n\nGeocodioGeocoder.prototype._formatResult = function (result) {\n  var accuracy = result.accuracy < 1 ? result.accuracy - 0.1 : 1;\n  return {\n    latitude: result.location.lat,\n    longitude: result.location.lng,\n    country: result.address_components.country,\n    formattedAddress: result.formatted_address,\n    city: result.address_components.city,\n    state: result.address_components.state,\n    zipcode: result.address_components.zip,\n    streetName: result.address_components.formatted_street,\n    streetNumber: result.address_components.number,\n    countryCode: null,\n    extra: {\n      confidence: accuracy || 0\n    }\n  };\n};\n/**\n * Reverse geocoding\n * @param {lat:<number>,lon:<number>}  lat: Latitude, lon: Longitude\n * @param <function> callback Callback method\n */\n\n\nGeocodioGeocoder.prototype._reverse = function (query, callback) {\n  var lat = query.lat;\n  var lng = query.lon;\n\n  var _this = this;\n\n  this.httpAdapter.get(this._endpoint + '/reverse', {\n    q: lat + ',' + lng,\n    api_key: querystring.unescape(this.apiKey)\n  }, function (err, result) {\n    if (err) {\n      return callback(err);\n    }\n\n    var results = [];\n    var locations = result.results;\n\n    for (var i = 0; i < locations.length; i++) {\n      results.push(_this._formatResult(locations[i]));\n    }\n\n    results.raw = result;\n    callback(false, results);\n  });\n};\n\nmodule.exports = GeocodioGeocoder;","map":null,"metadata":{},"sourceType":"script"}