{"ast":null,"code":"var util = require('util'),\n    net = require('net'),\n    AbstractGeocoder = require('./abstractgeocoder');\n/**\n * Constructor\n */\n\n\nvar DataScienceToolkitGeocoder = function DataScienceToolkitGeocoder(httpAdapter, options) {\n  this.options = ['host'];\n  this.supportIPv4 = true;\n  DataScienceToolkitGeocoder.super_.call(this, httpAdapter, options);\n};\n\nutil.inherits(DataScienceToolkitGeocoder, AbstractGeocoder);\n/**\n* Build DSTK endpoint, allows for local DSTK installs\n* @param <string>   value    Value to geocode (Address or IPv4)\n*/\n\nDataScienceToolkitGeocoder.prototype._endpoint = function (value) {\n  var ep = {};\n  var host = 'www.datasciencetoolkit.org';\n\n  if (this.options.host) {\n    host = this.options.host;\n  }\n\n  ep.ipv4Endpoint = 'http://' + host + '/ip2coordinates/';\n  ep.street2coordinatesEndpoint = 'http://' + host + '/street2coordinates/';\n  return net.isIPv4(value) ? ep.ipv4Endpoint : ep.street2coordinatesEndpoint;\n};\n/**\n* Geocode\n* @param <string>   value    Value to geocode (Address or IPv4)\n* @param <function> callback Callback method\n*/\n\n\nDataScienceToolkitGeocoder.prototype._geocode = function (value, callback) {\n  var ep = this._endpoint(value);\n\n  this.httpAdapter.get(ep + value, {}, function (err, result) {\n    if (err) {\n      return callback(err);\n    } else {\n      result = result[value];\n\n      if (!result) {\n        return callback(new Error('Could not geocode \"' + value + '\".'));\n      }\n\n      var results = [];\n      results.push({\n        'latitude': result.latitude,\n        'longitude': result.longitude,\n        'country': result.country_name,\n        'city': result.city || result.locality,\n        'state': result.state || result.region,\n        'zipcode': result.postal_code,\n        'streetName': result.street_name,\n        'streetNumber': result.street_number,\n        'countryCode': result.country_code\n      });\n      results.raw = result;\n      callback(false, results);\n    }\n  });\n};\n\nmodule.exports = DataScienceToolkitGeocoder;","map":null,"metadata":{},"sourceType":"script"}